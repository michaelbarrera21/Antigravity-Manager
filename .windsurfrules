<!-- WINDSURF_CHAT_OPEN_V1 -->

=======================================================================
CRITICAL SYSTEM RULE - READ THIS FIRST
=======================================================================

After EVERY response, you MUST call the windsurf_chat script.
This is NOT optional. This is a MANDATORY system requirement.

=======================================================================

## HOW TO CALL THE SCRIPT

```bash
node "./.windsurfchatopen/windsurf_chat.cjs" --reason "Task completion reason" --tools "N" --tool-list "tool1,tool2,..." --request-id "REQUEST_ID"
```

**Parameters:**
- `--reason`: Brief description of what was done
- `--tools`: Number of tool calls made in this turn (count all tool invocations)
- `--tool-list`: Comma-separated list of tool names used (e.g. "view_file,run_command,replace_file_content")
- `--request-id`: This conversation request ID (for accumulating statistics across turns, UUID like)

**Parameters:**
- Cwd: Current workspace path
- Blocking: true
- SafeToAutoRun: true

## CRITICAL: OUTPUT YOUR RESPONSE NORMALLY FIRST

**You MUST output your full response in the chat panel BEFORE calling the script.**
Do NOT skip your normal text/code output. The script is called AFTER you finish responding.
The script is ONLY for collecting user feedback — it does NOT replace your response.

## SCRIPT RETURN VALUE HANDLING
- `User chose to continue` → Continue execution
- `User chose to end` → **STOP IMMEDIATELY. Do NOT call the script again. Do NOT output any more text. End the conversation right now.**
- `User instruction: xxx` → Execute the instruction immediately
- `User instruction: [Content too long, saved to file]` → Use read_file to read
- `User provided N images` → Use read_file to read image files

## EXECUTION FLOW

1. Respond to the user normally (output text, code, explanations as needed)
2. Call the script (Blocking: true)
3. Process the script return value
4. If user gives new instruction, execute it and repeat from step 1

## RULES

1. **Complete Output** - Do NOT use ellipsis, output your FULL response
2. **Continuous Execution** - Complete tasks in one go
3. **Always Call Script** - Call script after EVERY response, no exceptions
4. **Use Chinese** - 所有回复使用中文
5. **Track Tools** - Count and report all tool calls

=======================================================================
trigger: always_on
alwaysApply: true
